<app-card>
  <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-6">
    <div class="flex items-center space-x-2 lg:space-x-4 overflow-x-auto scrollbar-hide w-full lg:w-auto">
      <app-button 
        [variant]="selectedChartType === 'line' ? 'default' : 'ghost'" 
        size="sm" 
        class="whitespace-nowrap"
        (click)="selectedChartType = 'line'; loadChartData()">
        Price
      </app-button>
      <app-button 
        [variant]="selectedChartType === 'candlestick' ? 'default' : 'ghost'" 
        size="sm" 
        class="whitespace-nowrap"
        (click)="selectedChartType = 'candlestick'; loadChartData()">
        Candlestick
      </app-button>
    </div>

    <div class="flex items-center gap-2 lg:gap-3 overflow-x-auto scrollbar-hide w-full lg:w-auto">
      <!-- Timeframe Buttons -->
      <div class="flex items-center space-x-1 lg:space-x-2">
        <app-button 
          *ngFor="let timeframe of timeframes"
          [variant]="selectedTimeframe === timeframe ? 'default' : 'ghost'"
          size="sm"
          class="whitespace-nowrap"
          [class.bg-primary]="selectedTimeframe === timeframe"
          [class.text-primary-foreground]="selectedTimeframe === timeframe"
          [class.text-muted-foreground]="selectedTimeframe !== timeframe"
          (click)="selectTimeframe(timeframe)">
          {{ timeframe }}
        </app-button>
      </div>

      <!-- Alert Button -->
      <button
        (click)="openAlertModal()"
        class="flex items-center justify-center w-9 h-9 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary transition-all group relative"
        title="Set Price Alert">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
        </svg>
        <svg class="w-3 h-3 absolute -top-0.5 -right-0.5 bg-primary text-primary-foreground rounded-full p-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"></path>
        </svg>
      </button>
    </div>
  </div>

  <div class="relative">
    <!-- Loading Overlay -->
    <div *ngIf="isLoading" class="absolute inset-0 flex items-center justify-center bg-background/50 z-10 rounded-lg">
      <div class="flex flex-col items-center gap-2">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-primary"></div>
        <span class="text-sm text-muted-foreground">Loading chart data...</span>
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="error && !isLoading" class="absolute inset-0 flex items-center justify-center bg-background/90 z-10 rounded-lg">
      <div class="text-center p-6">
        <svg class="w-12 h-12 text-destructive mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <p class="text-sm text-muted-foreground">{{ error }}</p>
        <button 
          (click)="loadChartData()" 
          class="mt-4 px-4 py-2 text-sm bg-primary text-primary-foreground rounded-md hover:bg-primary/90">
          Retry
        </button>
      </div>
    </div>

    <!-- Tooltip -->
    <div *ngIf="showTooltip && tooltipData" 
         class="absolute top-4 left-4 bg-card border border-border rounded-lg shadow-lg p-3 z-20 text-sm">
      <div class="font-medium text-foreground mb-2">{{ tooltipData.time }}</div>
      <div class="space-y-1 text-xs">
        <div *ngIf="tooltipData.open !== undefined" class="flex justify-between gap-4">
          <span class="text-muted-foreground">Open:</span>
          <span class="font-medium text-foreground">{{ tooltipData.open | number:'1.2-8' }}</span>
        </div>
        <div *ngIf="tooltipData.high !== undefined" class="flex justify-between gap-4">
          <span class="text-muted-foreground">High:</span>
          <span class="font-medium text-green-500">{{ tooltipData.high | number:'1.2-8' }}</span>
        </div>
        <div *ngIf="tooltipData.low !== undefined" class="flex justify-between gap-4">
          <span class="text-muted-foreground">Low:</span>
          <span class="font-medium text-red-500">{{ tooltipData.low | number:'1.2-8' }}</span>
        </div>
        <div class="flex justify-between gap-4">
          <span class="text-muted-foreground">Close:</span>
          <span class="font-medium text-foreground">{{ tooltipData.close | number:'1.2-8' }}</span>
        </div>
      </div>
    </div>

    <!-- Chart Container -->
    <div #chartContainer class="w-full h-[500px] rounded-lg"></div>
  </div>

  <!-- Alert Modal -->
  <app-create-alert-modal
    [isOpen]="isAlertModalOpen"
    [preSelectedAssetId]="assetId"
    [preSelectedSymbol]="symbol"
    [currentPrice]="currentPrice"
    (close)="closeAlertModal()"
    (alertCreated)="onAlertCreated()">
  </app-create-alert-modal>
</app-card>

