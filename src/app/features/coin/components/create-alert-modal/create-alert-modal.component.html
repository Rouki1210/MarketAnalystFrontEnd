<div *ngIf="isOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm" (click)="closeModal()">
  <div class="bg-card border border-border rounded-lg shadow-2xl w-full max-w-md mx-4 animate-in fade-in zoom-in duration-200" (click)="stopPropagation($event)">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-border">
      <div class="flex items-center gap-3">
        <div class="flex items-center justify-center w-10 h-10 rounded-full bg-primary/10">
          <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
          </svg>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-foreground">Create Price Alert</h3>
          <p class="text-sm text-muted-foreground">Get notified when price reaches target</p>
        </div>
      </div>
      <button (click)="closeModal()" class="text-muted-foreground hover:text-foreground transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Form -->
    <form (ngSubmit)="onSubmit()" class="p-6 space-y-5">
      <!-- Asset Selection -->
      <div>
        <label class="block text-sm font-medium text-foreground mb-2">
          Select Coin <span class="text-destructive">*</span>
        </label>
        <select 
          [(ngModel)]="selectedAssetId" 
          name="asset"
          required
          class="w-full px-4 py-2.5 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all">
          <option value="">Choose a coin...</option>
          <option *ngFor="let coin of coins" [value]="coin.id">
            {{ coin.name }} ({{ coin.symbol }})
          </option>
        </select>
      </div>

      <!-- Current Price Display -->
      <div *ngIf="currentPrice && preSelectedSymbol" class="p-3 bg-muted/50 rounded-lg">
        <div class="text-xs text-muted-foreground mb-1">Current Price ({{ preSelectedSymbol }})</div>
        <div class="text-lg font-semibold text-foreground">${{ currentPrice | number:'1.2-8' }}</div>
      </div>

      <!-- Alert Type -->
      <div>
        <label class="block text-sm font-medium text-foreground mb-2">
          Alert Type <span class="text-destructive">*</span>
        </label>
        <div class="grid grid-cols-3 gap-2">
          <button
            type="button"
            (click)="alertType = 'ABOVE'"
            [class.bg-primary]="alertType === 'ABOVE'"
            [class.text-primary-foreground]="alertType === 'ABOVE'"
            [class.bg-background]="alertType !== 'ABOVE'"
            [class.text-foreground]="alertType !== 'ABOVE'"
            class="px-4 py-2.5 border border-border rounded-lg font-medium transition-all hover:border-primary">
            Above
          </button>
          <button
            type="button"
            (click)="alertType = 'BELOW'"
            [class.bg-primary]="alertType === 'BELOW'"
            [class.text-primary-foreground]="alertType === 'BELOW'"
            [class.bg-background]="alertType !== 'BELOW'"
            [class.text-foreground]="alertType !== 'BELOW'"
            class="px-4 py-2.5 border border-border rounded-lg font-medium transition-all hover:border-primary">
            Below
          </button>
          <button
            type="button"
            (click)="alertType = 'REACHES'"
            [class.bg-primary]="alertType === 'REACHES'"
            [class.text-primary-foreground]="alertType === 'REACHES'"
            [class.bg-background]="alertType !== 'REACHES'"
            [class.text-foreground]="alertType !== 'REACHES'"
            class="px-4 py-2.5 border border-border rounded-lg font-medium transition-all hover:border-primary">
            Reaches
          </button>
        </div>
      </div>

      <!-- Target Price -->
      <div>
        <label class="block text-sm font-medium text-foreground mb-2">
          Target Price <span class="text-destructive">*</span>
        </label>
        <div class="relative">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground">$</span>
          <input 
            type="number" 
            [(ngModel)]="targetPrice"
            name="targetPrice"
            step="0.01"
            min="0"
            required
            placeholder="Enter target price"
            class="w-full pl-8 pr-4 py-2.5 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all">
        </div>
      </div>

      <!-- Repeating Toggle -->
      <div class="flex items-center justify-between p-4 bg-muted/30 rounded-lg">
        <div>
          <div class="font-medium text-foreground">Repeating Alert</div>
          <div class="text-sm text-muted-foreground">Alert again if price crosses target multiple times</div>
        </div>
        <label class="relative inline-flex items-center cursor-pointer">
          <input 
            type="checkbox" 
            [(ngModel)]="isRepeating"
            name="isRepeating"
            class="sr-only peer">
          <div class="w-11 h-6 bg-muted peer-focus:ring-2 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
        </label>
      </div>

      <!-- Note (Optional) -->
      <div>
        <label class="block text-sm font-medium text-foreground mb-2">
          Note (Optional)
        </label>
        <textarea 
          [(ngModel)]="note"
          name="note"
          rows="2"
          placeholder="Add a note for this alert..."
          class="w-full px-4 py-2.5 bg-background border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all resize-none">
        </textarea>
      </div>

      <!-- Error Message -->
      <div *ngIf="error" class="p-3 bg-destructive/10 border border-destructive/20 rounded-lg">
        <p class="text-sm text-destructive">{{ error }}</p>
      </div>

      <!-- Actions -->
      <div class="flex gap-3 pt-2">
        <button
          type="button"
          (click)="closeModal()"
          class="flex-1 px-4 py-2.5 bg-background border border-border rounded-lg font-medium text-foreground hover:bg-muted transition-all">
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="isSubmitting || !selectedAssetId || !targetPrice"
          class="flex-1 px-4 py-2.5 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
          <span *ngIf="!isSubmitting">Create Alert</span>
          <span *ngIf="isSubmitting" class="flex items-center justify-center gap-2">
            <svg class="animate-spin h-4 w-4" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Creating...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
