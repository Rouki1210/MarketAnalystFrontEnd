<div class="mx-auto px-3 lg:px-4 xl:px-6 py-6 lg:py-8">
  <!-- ==================== TAB NAVIGATION ==================== -->
  <div class="flex items-center space-x-3 lg:space-x-4 mb-6 overflow-x-auto scrollbar-hide border-b border-border">
    <app-button 
      *ngFor="let tab of tabs"
      variant="ghost"
      size="sm"
      class="whitespace-nowrap rounded-none rounded-t-md pb-3 -mb-px"
      [class.border-b-2]="selectedTab === tab"
      [class.border-primary]="selectedTab === tab"
      [class.text-foreground]="selectedTab === tab"
      [class.text-muted-foreground]="selectedTab !== tab"
      (click)="selectTab(tab)">
      {{ tab }}
    </app-button>
  </div>

  <!-- ==================== FILTERS & CONTROLS ==================== -->
  <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 mb-4">
    <!-- Network Filters -->
    <div class="flex items-center space-x-2">
      <div class="flex items-center space-x-2 overflow-x-auto scrollbar-hide">
        <!-- Primary Network Buttons -->
        <app-button
          *ngFor="let network of networks"
          [variant]="selectedNetwork === network ? 'default' : 'ghost'"
          size="sm"
          class="whitespace-nowrap"
          (click)="selectNetwork(network)">
          {{ network }}
        </app-button>
        
        <!-- More Networks Button -->
        <button
          #moreButton
          (click)="toggleNetworkMenu()"
          class="inline-flex items-center justify-center h-8 px-3 text-xs font-medium rounded-md transition-colors whitespace-nowrap flex-shrink-0 network-more-btn hover:bg-muted/50 hover:text-foreground">
          More
          <svg 
            class="w-3 h-3 ml-1 transition-transform"
            [class.rotate-180]="showNetworkMenu()"
            xmlns="http://www.w3.org/2000/svg" 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
      </div>
    </div>

    <!-- Table Action Buttons -->
    <div class="flex items-center space-x-2">
      <app-button 
        variant="ghost" 
        size="sm" 
        [class.text-primary]="sortField === 'marketCap'"
        [class.text-muted-foreground]="sortField !== 'marketCap'"
        (click)="sortBy('marketCap')">
        <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        <span class="hidden sm:inline">Market Cap</span>
        <span *ngIf="sortField === 'marketCap'" class="ml-1 text-xs">
          {{ sortDirection === 'asc' ? '↑' : '↓' }}
        </span>
      </app-button>
      
      <app-button 
        variant="ghost" 
        size="sm" 
        class="hidden sm:flex"
        [class.text-primary]="sortField === 'volume'"
        [class.text-muted-foreground]="sortField !== 'volume'"
        (click)="sortBy('volume')">
        <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        <span class="hidden md:inline">Volume(24h)</span>
        <span *ngIf="sortField === 'volume'" class="ml-1 text-xs">
          {{ sortDirection === 'asc' ? '↑' : '↓' }}
        </span>
      </app-button>
      
      <!-- Clear Filters Button -->
      <app-button 
        *ngIf="sortField !== 'rank' || sortDirection !== 'asc'"
        variant="ghost" 
        size="sm"
        class="text-destructive hover:text-destructive"
        (click)="clearFilters()">
        <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        <span class="hidden md:inline">Clear</span>
      </app-button>
      
      <app-button variant="ghost" size="sm" class="text-muted-foreground">
        <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        <span class="hidden md:inline">Filters</span>
      </app-button>
    </div>
  </div>

  <!-- ==================== CRYPTOCURRENCY TABLE ==================== -->
  <app-card [padding]="false">
    <div class="overflow-x-auto">
      <table class="w-full min-w-[800px]">
        <thead>
          <tr class="border-b border-border bg-background/50">
            <th class="text-left px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium sticky left-0 bg-background/50">#</th>
            <th class="text-left px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium">Name</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium">Price</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium">1h %</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium">24h %</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium">7d %</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium">Market Cap</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium hidden xl:table-cell">Volume(24h)</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium hidden 2xl:table-cell">Circulating Supply</th>
            <th class="text-right px-3 lg:px-4 py-3 text-xs lg:text-sm text-muted-foreground font-medium hidden lg:table-cell">Last 7 Days</th>
          </tr>
        </thead>
        <tbody>
          <!-- Loading Skeleton -->
          <tr *ngIf="isLoading" class="border-b border-border">
            <td colspan="10" class="px-3 lg:px-4 py-3 lg:py-4">
              <div class="space-y-3">
                <div *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]" class="flex items-center space-x-4 animate-pulse">
                  <div class="h-4 bg-muted rounded w-8"></div>
                  <div class="h-8 w-8 bg-muted rounded-full"></div>
                  <div class="flex-1 space-y-2">
                    <div class="h-4 bg-muted rounded w-32"></div>
                    <div class="h-3 bg-muted rounded w-16"></div>
                  </div>
                  <div class="h-4 bg-muted rounded w-24"></div>
                  <div class="h-4 bg-muted rounded w-16"></div>
                  <div class="h-4 bg-muted rounded w-16"></div>
                  <div class="h-4 bg-muted rounded w-16"></div>
                  <div class="h-4 bg-muted rounded w-32"></div>
                </div>
              </div>
            </td>
          </tr>

          <!-- Actual Data -->
          <tr 
            *ngFor="let coin of paginatedCoins"
            class="border-b border-border hover:bg-muted/30 transition-colors cursor-pointer"
            (click)="navigateToCoin(coin.symbol)">
            <td class="px-3 lg:px-4 py-3 lg:py-4 sticky left-0 bg-card">
              <div class="flex items-center space-x-2">
                <!-- Watchlist Star Icon -->
                <button
                  (click)="toggleWatchlist(coin.id, $event)"
                  class="watchlist-star-btn p-1 rounded hover:bg-muted/40 transition-colors"
                  [attr.aria-label]="isInWatchlist(coin.id) ? 'Remove from watchlist' : 'Add to watchlist'">
                  <svg 
                    class="w-3 h-3 lg:w-4 lg:h-4 transition-all duration-200" 
                    [class.text-yellow-500]="isInWatchlist(coin.id)"
                    [class.text-muted-foreground]="!isInWatchlist(coin.id)"
                    [class.fill-yellow-500]="isInWatchlist(coin.id)"
                    [class.hover:text-yellow-500]="!isInWatchlist(coin.id)"
                    xmlns="http://www.w3.org/2000/svg" 
                    viewBox="0 0 24 24" 
                    [attr.fill]="isInWatchlist(coin.id) ? 'currentColor' : 'none'"
                    stroke="currentColor" 
                    stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                </button>
                <span class="text-sm lg:text-base text-foreground">{{ coin.rank }}</span>
              </div>
            </td>
            <td class="px-3 lg:px-4 py-3 lg:py-4">
              <div class="flex items-center space-x-2 lg:space-x-3">
                <div class="w-6 h-6 lg:w-8 lg:h-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-xs lg:text-sm font-bold flex-shrink-0">
                  <img [src]="coin.icon" alt="{{ coin.name }}" class="w-full h-full object-cover rounded-full">
                </div>
                <div class="min-w-0">
                  <div class="font-medium text-sm lg:text-base text-foreground truncate">{{ coin.name }}</div>
                  <div class="text-xs lg:text-sm text-muted-foreground">{{ coin.symbol }}</div>
                </div>
              </div>
            </td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right text-sm lg:text-base text-foreground font-medium">
              <span [ngClass]="coin.highlightClass">{{ coin.price }}</span>
            </td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right text-sm lg:text-base" [ngClass]="getPercentClass(coin.isPositive1h)">
              {{ coin.change1h }}
            </td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right text-sm lg:text-base" [ngClass]="getPercentClass(coin.isPositive24h)">
              {{ coin.change24h }}
            </td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right text-sm lg:text-base" [ngClass]="getPercentClass(coin.isPositive7d)">
              {{ coin.change7d }}
            </td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right text-sm lg:text-base text-foreground">{{ coin.marketCap }}</td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right text-sm lg:text-base text-foreground hidden xl:table-cell">{{ coin.volume }}</td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right text-sm lg:text-base text-foreground hidden 2xl:table-cell">{{ coin.supply }}</td>
            <td class="px-3 lg:px-4 py-3 lg:py-4 text-right hidden lg:table-cell">
              <div class="flex justify-end">
                <app-sparkline 
                  [symbol]="coin.symbol"
                  [isPositive]="coin.isPositive7d"
                  [width]="80"
                  [height]="32">
                </app-sparkline>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ==================== PAGINATION ==================== -->
    <div *ngIf="totalPages > 1" class="px-3 lg:px-4 py-4 border-t border-border">
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4 relative">
        <!-- Page Info -->
        <div class="text-sm text-muted-foreground sm:absolute sm:left-0">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredCoins.length) }} of {{ filteredCoins.length }} coins
        </div>

        <!-- Pagination Controls -->
        <div class="flex items-center space-x-1">
          <!-- Previous Button -->
          <button
            (click)="previousPage()"
            [disabled]="currentPage === 1"
            [class.text-muted-foreground]="currentPage === 1"
            class="inline-flex items-center justify-center h-9 px-3 text-sm font-medium rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed hover:bg-muted/50 hover:text-foreground">
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            <span class="hidden sm:inline ml-1">Previous</span>
          </button>

          <!-- Page Numbers -->
          <div class="flex items-center space-x-1">
            <button
              *ngFor="let page of getPageNumbers()"
              (click)="page !== -1 ? goToPage(page) : null"
              [disabled]="page === -1"
              [class.bg-primary]="page === currentPage"
              [class.text-primary-foreground]="page === currentPage"
              [class.text-foreground]="page !== currentPage && page !== -1"
              [class.cursor-default]="page === -1"
              class="inline-flex items-center justify-center h-9 min-w-[36px] px-3 text-sm font-medium rounded-md transition-colors hover:bg-muted/50">
              {{ page === -1 ? '...' : page }}
            </button>
          </div>

          <!-- Next Button -->
          <button
            (click)="nextPage()"
            [disabled]="currentPage === totalPages"
            [class.text-muted-foreground]="currentPage === totalPages"
            class="inline-flex items-center justify-center h-9 px-3 text-sm font-medium rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed hover:bg-muted/50 hover:text-foreground">
            <span class="hidden sm:inline mr-1">Next</span>
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </app-card>
</div>

<!-- ==================== NETWORK DROPDOWN MENU ==================== -->
<!-- Fixed positioned dropdown to prevent overflow clipping -->
<div 
  *ngIf="showNetworkMenu()" 
  class="fixed w-64 bg-card border border-border rounded-xl shadow-2xl overflow-hidden z-[9999] network-menu-container"
  [style.left.px]="menuPosition.left"
  [style.top.px]="menuPosition.top">
  <div class="max-h-96 overflow-y-auto custom-scrollbar">
    <div class="p-2">
      <button
        *ngFor="let network of additionalNetworks"
        (click)="selectAdditionalNetwork(network)"
        class="w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg hover:bg-muted/40 transition-colors text-left group">
        <div 
          [class]="network.color"
          class="w-8 h-8 rounded-full flex items-center justify-center text-white flex-shrink-0">
          <span class="text-lg">{{ network.icon }}</span>
        </div>
        <span class="text-sm text-foreground group-hover:text-primary transition-colors font-medium">
          {{ network.name }}
        </span>
      </button>
    </div>
  </div>
</div>
